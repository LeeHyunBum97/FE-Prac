<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AjaxJson</title>
    <script>
        window.addEventListener("load", (e) => {
            //Script를 헤드 안에 작성하는 경우만 위 메서드 사용
            //DOM 객체 찾아오기
            let btn = document.getElementById("btn");
            let display = document.getElementById("display");

            //버튼을 눌렀을 때 이벤트 처리
            btn.addEventListener("click", (e) => {
                // Ajax 요청 객체
                let request = new XMLHttpRequest();

                // 요청 준비
                request.open('GET', "./resource/data.json");

                // 요청 전송
                request.send('');

                // 응답 받기
                // 1. 응답을 성공적으로 받았을 때
                request.addEventListener("load", (e) =>{
                    //XML 이외의 데이터 읽기
                    // display.innerHTML = request.responseText; -> 잘 가져오는지 확인
                    
                    // 받아온 문자열 JSON으로 Parsing
                    let result = JSON.parse(request.responseText);
                    display.innerHTML = `<p>데이터 개수 : ${result.count} </p>`;

                    let ar = result.documents;

                    // 배열 자체를 순회
                    for(doc of ar){
                        display.innerHTML += "<h3>이름: " + doc.name + "</h3>"
                    }

                    // 보여주는 것은 forEach를 사용하는 것이 바람직함.
                    // 배열을 순회하면서 {}안의 내용을 수행
                    ar.forEach((doc) => {
                        display.innerHTML += "<h3>나이: " + doc.age + "</h3>"
                    });
                }); 
                
                // 2. 요청 도중 문제가 발생 했을 때
                request.addEventListener('error', () => {
                    display.innerHTML = e.message;
                });
            })
        })
    </script>
</head>
<body>
    <button id = "btn">json 데이터 가져오기</button>>
    <div id = "display"></div>
</body>
</html>